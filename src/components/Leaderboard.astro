---
import { desc } from "drizzle-orm";
import { drizzle } from "drizzle-orm/d1";
import Layout from "../layouts/Layout.astro";
import { getTranslations } from "../i18n/utils";
import { players } from "../db/schema";

interface Props {
  locale: string;
}

const { locale } = Astro.props;
const t = getTranslations(locale);

const db = drizzle(Astro.locals.runtime.env.DB);
const sortedData = await db
  .select()
  .from(players)
  .orderBy(desc(players.points));
---

<Layout title={t.title} locale={locale}>
  <div class="container mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold text-center text-gray-800 mb-8">
      {t.title}
    </h1>

    <div class="overflow-x-auto">
      <table class="w-full max-w-2xl mx-auto bg-white rounded-lg shadow-md">
        <thead class="bg-gray-800 text-white">
          <tr>
            <th class="px-6 py-3 text-left">{t.name}</th>
            <th class="px-6 py-3 text-left">{t.ficuzPoints}</th>
          </tr>
        </thead>
        <tbody class="divide-y divide-gray-200">
          {
            sortedData.map((entry, index) => {
              const medal =
                index === 0
                  ? "ðŸ¥‡"
                  : index === 1
                    ? "ðŸ¥ˆ"
                    : index === 2
                      ? "ðŸ¥‰"
                      : "";
              return (
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 font-medium text-gray-900">
                    {entry.name}
                    {medal && <span class="mr-2">{medal}</span>}
                  </td>
                  <td class="px-6 py-4 text-gray-700">
                    {entry.points} {t.unit}
                  </td>
                </tr>
              );
            })
          }
        </tbody>
      </table>
    </div>

    <div class="max-w-2xl mx-auto mt-8 bg-white rounded-lg shadow-md p-6">
      <h2 class="text-xl font-bold text-gray-800 mb-4">{t.rules}</h2>
      <div class="space-y-3">
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
          <span
            class="shrink-0 w-16 h-8 flex items-center justify-center bg-red-400 text-white font-bold rounded text-sm"
          >
            +0.5 PF
          </span>
          <p class="text-gray-700">{t.rule4Desc}</p>
        </div>
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
          <span
            class="shrink-0 w-16 h-8 flex items-center justify-center bg-red-500 text-white font-bold rounded text-sm"
          >
            +1 PF
          </span>
          <p class="text-gray-700">{t.rule5Desc}</p>
        </div>
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
          <span
            class="shrink-0 w-16 h-8 flex items-center justify-center bg-red-500 text-white font-bold rounded text-sm"
          >
            +1 PF
          </span>
          <p class="text-gray-700">{t.rule1Desc}</p>
        </div>
        <div class="flex flex-col gap-2 p-3 bg-gray-50 rounded-lg">
          <div class="flex items-center gap-3">
            <span
              class="shrink-0 w-16 h-8 flex items-center justify-center bg-red-500 text-white font-bold rounded text-sm"
            >
              +1 PF
            </span>
            <p class="text-gray-700">{t.rule2Desc}</p>
          </div>
          <div class="flex text-gray-500 text-sm ml-19 pl-1">
            <span class="shrink-0 mr-1">*</span>
            <span>{t.rule6Desc}</span>
          </div>
        </div>
        <div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg">
          <span
            class="shrink-0 w-16 h-8 flex items-center justify-center bg-red-700 text-white font-bold rounded text-sm"
          >
            +2 PF
          </span>
          <p class="text-gray-700">{t.rule3Desc}</p>
        </div>
      </div>
    </div>
  </div>
</Layout>
